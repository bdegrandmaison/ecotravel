import{R as ae,a as i,C as re,t as V,ar as t,as as ne}from"./index-BQq58hX_.js";import{u as ie,a as L}from"./axios-B76b27Ao.js";import{F as p,u as oe,C as le,I as ce,A as ue,B as de}from"./useMutation-qbsByOmG.js";import{J as me,K as pe,L as xe,M as ve,N as fe,G as _,O as A,P as B,Q as ye}from"./App-B9QT_Xep.js";import{C as he}from"./utils-C_d3oV-r.js";function R(s){return["small","middle","large"].includes(s)}function q(s){return s?typeof s=="number"&&!Number.isNaN(s):!1}const T=ae.createContext({latestIndex:0}),ge=T.Provider,je=s=>{let{className:r,index:o,children:a,split:n,style:c}=s;const{latestIndex:e}=i.useContext(T);return a==null?null:i.createElement(i.Fragment,null,i.createElement("div",{className:r,style:c},a),o<e&&n&&i.createElement("span",{className:`${r}-split`},n))};var be=function(s,r){var o={};for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&r.indexOf(a)<0&&(o[a]=s[a]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(s);n<a.length;n++)r.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(s,a[n])&&(o[a[n]]=s[a[n]]);return o};const Ce=i.forwardRef((s,r)=>{var o,a,n;const{getPrefixCls:c,space:e,direction:g}=i.useContext(re),{size:d=(o=e==null?void 0:e.size)!==null&&o!==void 0?o:"small",align:x,className:j,rootClassName:b,children:C,direction:l="horizontal",prefixCls:v,split:S,style:M,wrap:K=!1,classNames:P,styles:N}=s,Q=be(s,["size","align","className","rootClassName","children","direction","prefixCls","split","style","wrap","classNames","styles"]),[f,y]=Array.isArray(d)?d:[d,d],O=R(y),D=R(f),W=q(y),J=q(f),E=pe(C,{keepEmpty:!0}),F=x===void 0&&l==="horizontal"?"center":x,u=c("space",v),[U,X,Y]=xe(u),Z=V(u,e==null?void 0:e.className,X,`${u}-${l}`,{[`${u}-rtl`]:g==="rtl",[`${u}-align-${F}`]:F,[`${u}-gap-row-${y}`]:O,[`${u}-gap-col-${f}`]:D},j,b,Y),k=V(`${u}-item`,(a=P==null?void 0:P.item)!==null&&a!==void 0?a:(n=e==null?void 0:e.classNames)===null||n===void 0?void 0:n.item);let $=0;const ee=E.map((m,w)=>{var z,I;m!=null&&($=w);const se=(m==null?void 0:m.key)||`${k}-${w}`;return i.createElement(je,{className:k,key:se,index:w,split:S,style:(z=N==null?void 0:N.item)!==null&&z!==void 0?z:(I=e==null?void 0:e.styles)===null||I===void 0?void 0:I.item},m)}),te=i.useMemo(()=>({latestIndex:$}),[$]);if(E.length===0)return null;const h={};return K&&(h.flexWrap="wrap"),!D&&J&&(h.columnGap=f),!O&&W&&(h.rowGap=y),U(i.createElement("div",Object.assign({ref:r,className:Z,style:Object.assign(Object.assign(Object.assign({},h),e==null?void 0:e.style),M)},Q),i.createElement(ge,{value:te},ee)))}),H=Ce;H.Compact=me;const Se=async s=>{const{data:r}=await L.get(`/api/destinations/${s}`);return r},Pe=async s=>(await L.post("/api/book",s)).data.ok,Ne=({form:s,children:r,isPending:o=!1,isFull:a=!1})=>{const[n,c]=i.useState(!1),e=p.useWatch([],s);return i.useEffect(()=>{s.validateFields({validateOnly:!0}).then(()=>c(!0)).catch(()=>c(!1))},[s,e]),t.jsx(de,{type:"primary",htmlType:"submit",disabled:!n||o||a,children:o?t.jsx(ne,{}):r})},De=()=>{const[s]=p.useForm(),{id:r}=ve(),[o,a]=i.useState(!1),[n,c]=i.useState(1),{data:e,error:g,isLoading:d,refetch:x}=ie({queryKey:["destination",r],queryFn:()=>r?Se(r):Promise.reject(new Error("ID is undefined")),enabled:!!r}),{mutate:j,isPending:b}=oe({mutationFn:Pe,onSuccess:l=>{l&&(a(!0),x())}}),C=l=>{c(l.travellers),j({...l,destinationId:e==null?void 0:e.id})};if(d)return t.jsx(fe,{});if(g)return t.jsx("div",{children:"Erreur lors du chargement de la destination"});if(e){const l=e.currentParticipants>=e.maxParticipants;return t.jsx("div",{children:t.jsxs(he,{title:e.name,cover:t.jsxs(le,{autoplay:!0,arrows:!0,adaptiveHeight:!0,children:[t.jsx("div",{children:t.jsx("img",{loading:"eager",alt:e.image.altText,src:`${_()}${e.image.src}`,style:G})},0),e.additionalImages.map((v,S)=>t.jsx("div",{children:t.jsx("img",{loading:"eager",src:`${_()}${v.src}`,alt:v.altText,style:G})},S+1))]}),children:[t.jsx("p",{children:e.description}),t.jsxs("p",{children:[t.jsx("b",{children:"Location:"})," ",e.location]}),t.jsxs("p",{children:[t.jsx("b",{children:"Price:"})," ",A(e.price)," par jour et par personne"]}),t.jsxs("p",{children:[t.jsx("b",{children:"Dates:"})," Du ",B(e.startDate)," au"," ",B(e.endDate)]}),t.jsxs("p",{children:[t.jsx("b",{children:"Participants:"})," ",e.currentParticipants,"/",e.maxParticipants]}),t.jsxs("p",{children:[t.jsx("b",{children:"Pourquoi agir:"})," ",e.summary.why]}),t.jsxs("p",{children:[t.jsx("b",{children:"Ce que vous ferez:"})," ",e.summary.action]}),t.jsxs(p,{form:s,name:"bookForm",layout:"vertical",onFinish:C,disabled:l,children:[t.jsx(p.Item,{name:"travellers",label:"Nombre de voyageurs: ",rules:[{required:!0}],children:t.jsx(ce,{type:"number",min:1,max:e.maxParticipants-e.currentParticipants})}),t.jsx(p.Item,{children:t.jsx(H,{children:t.jsx(Ne,{form:s,isPending:b,isFull:l,children:"Réserver"})})})]}),o&&t.jsx(ue,{message:`Voyage réservé avec succès, partie paiement à venir pour votre paiement de ${A(e.price*n*ye(e.startDate,e.endDate))}`,type:"success"})]})})}},G={width:"100%",height:"500px",objectFit:"cover"};export{De as default};
