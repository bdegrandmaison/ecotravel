import{R as re,a as i,C as ne,J as V,av as t}from"./index-DLIZ2MBQ.js";import{u as ie,a as G}from"./axios-uUYEnw0_.js";import{F as p,u as oe,C as le,I as ce,A as ue,B as de}from"./useMutation-D6Krnsif.js";import{L as me,M as pe,N as xe,O as ve,J as _,P as A,Q as B,S as fe}from"./App-Dukthc0w.js";import{S as H,C as ye}from"./utils-Dkn14F7i.js";function R(s){return["small","middle","large"].includes(s)}function q(s){return s?typeof s=="number"&&!Number.isNaN(s):!1}const L=re.createContext({latestIndex:0}),he=L.Provider,ge=s=>{let{className:r,index:o,children:a,split:n,style:c}=s;const{latestIndex:e}=i.useContext(L);return a==null?null:i.createElement(i.Fragment,null,i.createElement("div",{className:r,style:c},a),o<e&&n&&i.createElement("span",{className:`${r}-split`},n))};var je=function(s,r){var o={};for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&r.indexOf(a)<0&&(o[a]=s[a]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(s);n<a.length;n++)r.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(s,a[n])&&(o[a[n]]=s[a[n]]);return o};const be=i.forwardRef((s,r)=>{var o,a,n;const{getPrefixCls:c,space:e,direction:g}=i.useContext(ne),{size:d=(o=e==null?void 0:e.size)!==null&&o!==void 0?o:"small",align:x,className:j,rootClassName:b,children:C,direction:l="horizontal",prefixCls:v,split:S,style:J,wrap:Q=!1,classNames:P,styles:N}=s,W=je(s,["size","align","className","rootClassName","children","direction","prefixCls","split","style","wrap","classNames","styles"]),[f,y]=Array.isArray(d)?d:[d,d],O=R(y),D=R(f),K=q(y),U=q(f),E=pe(C,{keepEmpty:!0}),F=x===void 0&&l==="horizontal"?"center":x,u=c("space",v),[X,Y,Z]=xe(u),ee=V(u,e==null?void 0:e.className,Y,`${u}-${l}`,{[`${u}-rtl`]:g==="rtl",[`${u}-align-${F}`]:F,[`${u}-gap-row-${y}`]:O,[`${u}-gap-col-${f}`]:D},j,b,Z),k=V(`${u}-item`,(a=P==null?void 0:P.item)!==null&&a!==void 0?a:(n=e==null?void 0:e.classNames)===null||n===void 0?void 0:n.item);let $=0;const te=E.map((m,w)=>{var z,I;m!=null&&($=w);const ae=(m==null?void 0:m.key)||`${k}-${w}`;return i.createElement(ge,{className:k,key:ae,index:w,split:S,style:(z=N==null?void 0:N.item)!==null&&z!==void 0?z:(I=e==null?void 0:e.styles)===null||I===void 0?void 0:I.item},m)}),se=i.useMemo(()=>({latestIndex:$}),[$]);if(E.length===0)return null;const h={};return Q&&(h.flexWrap="wrap"),!D&&U&&(h.columnGap=f),!O&&K&&(h.rowGap=y),X(i.createElement("div",Object.assign({ref:r,className:ee,style:Object.assign(Object.assign(Object.assign({},h),e==null?void 0:e.style),J)},W),i.createElement(he,{value:se},te)))}),M=be;M.Compact=me;const Ce=async s=>{const{data:r}=await G.get(`/api/destinations/${s}`);return r},Se=async s=>(await G.post("/api/book",s)).data.ok,Pe=({form:s,children:r,isPending:o=!1,isFull:a=!1})=>{const[n,c]=i.useState(!1),e=p.useWatch([],s);return i.useEffect(()=>{s.validateFields({validateOnly:!0}).then(()=>c(!0)).catch(()=>c(!1))},[s,e]),t.jsx(de,{type:"primary",htmlType:"submit",disabled:!n||o||a,children:o?t.jsx(H,{}):r})},Oe=()=>{const[s]=p.useForm(),{id:r}=ve(),[o,a]=i.useState(!1),[n,c]=i.useState(1),{data:e,error:g,isLoading:d,refetch:x}=ie({queryKey:["destination",r],queryFn:()=>r?Ce(r):Promise.reject(new Error("ID is undefined")),enabled:!!r}),{mutate:j,isPending:b}=oe({mutationFn:Se,onSuccess:l=>{l&&(a(!0),x())}}),C=l=>{c(l.travellers),j({...l,destinationId:e==null?void 0:e.id})};if(d)return t.jsx(H,{size:"large"});if(g)return t.jsx("div",{children:"Erreur lors du chargement de la destination"});if(e){const l=e.currentParticipants>=e.maxParticipants;return t.jsx("div",{children:t.jsxs(ye,{title:e.name,cover:t.jsxs(le,{autoplay:!0,arrows:!0,adaptiveHeight:!0,children:[t.jsx("div",{children:t.jsx("img",{loading:"eager",alt:e.image.altText,src:`${_()}${e.image.src}`,style:T})},0),e.additionalImages.map((v,S)=>t.jsx("div",{children:t.jsx("img",{loading:"eager",src:`${_()}${v.src}`,alt:v.altText,style:T})},S+1))]}),children:[t.jsx("p",{children:e.description}),t.jsxs("p",{children:[t.jsx("b",{children:"Location:"})," ",e.location]}),t.jsxs("p",{children:[t.jsx("b",{children:"Price:"})," ",A(e.price)," par jour et par personne"]}),t.jsxs("p",{children:[t.jsx("b",{children:"Dates:"})," Du ",B(e.startDate)," au"," ",B(e.endDate)]}),t.jsxs("p",{children:[t.jsx("b",{children:"Participants:"})," ",e.currentParticipants,"/",e.maxParticipants]}),t.jsxs("p",{children:[t.jsx("b",{children:"Pourquoi agir:"})," ",e.summary.why]}),t.jsxs("p",{children:[t.jsx("b",{children:"Ce que vous ferez:"})," ",e.summary.action]}),t.jsxs(p,{form:s,name:"bookForm",layout:"vertical",onFinish:C,disabled:l,children:[t.jsx(p.Item,{name:"travellers",label:"Nombre de voyageurs: ",rules:[{required:!0}],children:t.jsx(ce,{type:"number",min:1,max:e.maxParticipants-e.currentParticipants})}),t.jsx(p.Item,{children:t.jsx(M,{children:t.jsx(Pe,{form:s,isPending:b,isFull:l,children:"Réserver"})})})]}),o&&t.jsx(ue,{message:`Voyage réservé avec succès, partie paiement à venir pour votre paiement de ${A(e.price*n*fe(e.startDate,e.endDate))}`,type:"success"})]})})}},T={width:"100%",height:"500px",objectFit:"cover"};export{Oe as default};
